version: "3"

tasks:
  init:
    cmds:
      - echo "ğŸ•™ Initializing project...";
      - task create-docker-compose;
      - echo "ğŸ‰ Project initialized successfully!";
      - task help

  init-cms:
    cmds:
      - if [ -d backend ]; then
        echo "ğŸ‘‹ Backend folder already exists, skipping creation.";
        else
        echo "ğŸ•™ Creating backend folder...";
        mkdir backend;
        touch backend/.gitkeep;
        echo "node_modules\npublic/uploads" > backend/.gitignore;
        fi
      - echo "âœ… Finished initializing CMS folder"

  install:
    cmds:
      - echo "ğŸ•™ Installing Directus CMS and NextJS..."
      - task install-frontend
      - task start-cms
      - echo "âœ… Finished installing Directus CMS and NextJS."

  install-frontend:
    cmds:
      - chmod +x ./scripts/install-frontend.sh
      - ./scripts/install-frontend.sh
      - echo "âœ… Frontend installed."

  install-cms:
    cmds:
      - task start-cms

  up:
    cmds:
      - echo "ğŸš€ Starting Docker containers..."
      - docker-compose up -d
      - echo "âœ… Docker containers started."

  stop:
    cmds:
      - echo "ğŸ›‘ Stopping Docker containers..."
      - docker-compose stop
      - echo "âœ… Docker containers stopped."

  down:
    cmds:
      - echo "ğŸ›‘ Stopping and removing Docker containers..."
      - docker-compose down
      - echo "âœ… Docker containers stopped and removed."

  start:
    cmds:
      - task assert-docker-compose
      - task up

  start-frontend:
    cmds:
      - task assert-docker-compose
      - echo "ğŸš€ Starting NextJS..."
      - docker-compose up -d nextjs

  start-cms:
    cmds:
      - task assert-docker-compose
      - echo "ğŸš€ Starting Directus CMS..."
      - docker-compose up -d database
      - docker-compose up -d cache
      - docker-compose up -d directus

  stop-frontend:
    cmds:
      - echo "ğŸ›‘ Stopping NextJS..."
      - docker-compose stop nextjs

  stop-cms:
    cmds:
      - echo "ğŸ›‘ Stopping Directus CMS..."
      - docker-compose stop directus

  lint:
    cmds:
      - echo "ğŸ•™ Linting frontend code..."
      - docker-compose exec nextjs npm run lint
      - echo "âœ… Finished linting code."

  format:
    cmds:
      - echo "ğŸ•™ Formatting frontend code..."
      - docker-compose exec nextjs npm run format
      - echo "âœ… Finished formatting code."

  test:
    cmds:
      - echo "ğŸ•™ Running frontend tests..."
      - docker-compose run --rm nextjs npm run test
      - echo "âœ… Finished running tests."

  assert-docker-compose:
    cmds:
      - if [ ! -f docker-compose.yml ]; then
        echo "âŒ docker-compose.yml file not found. Please run 'task init' first.";
        exit 1;
        fi

  create-docker-compose:
    cmds:
      - cp templates/docker-compose.yml.template docker-compose.yml

  help:
    cmds:
      - bash ./scripts/help.sh

  clean:
    cmds:
      - bash ./scripts/clean.sh
